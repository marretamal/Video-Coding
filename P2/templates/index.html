<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video Transcoding GUI</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="container">
    <h1>ðŸŽ¬ Video Processing Studio</h1>
    <p class="subtitle">Upload â†’ Transcode â†’ Analyze</p>

    <!-- Upload Section -->
    <div class="card">
        <h2>1. Upload a Video</h2>
        <input id="fileInput" type="file" class="file-upload">
        <p class="hint">Accepted formats: MP4, MKV, WebM</p>
    </div>

    <!-- Single Transcoding -->
    <div class="card">
        <h2>2. Transcode to Another Codec</h2>

        <label>Select codec:</label>
        <select id="codec">
            <option value="vp8">VP8</option>
            <option value="vp9">VP9</option>
            <option value="h265">H.265</option>
            <option value="av1">AV1</option>
        </select>

        <button onclick="transcode()" class="btn primary">Convert</button>
    </div>

    <!-- Encoding Ladder -->
    <div class="card">
        <h2>3. Generate Encoding Ladder</h2>
        <p class="hint">Creates multiple renditions in a .zip (240p â†’ 1080p)</p>

        <button onclick="ladder()" class="btn secondary">Generate Ladder</button>
    </div>

    <!-- Video Info -->
    <div class="card">
        <h2>4. Analyze Video</h2>
        <button onclick="videoInfo()" class="btn info">Get Info</button>

        <pre id="infoDisplay"></pre>
    </div>
</div>

<script>
    async function transcode() {
        const file = document.getElementById("fileInput").files[0];
        const codec = document.getElementById("codec").value;

        if (!file) { alert("Please upload a video."); return; }

        const form = new FormData();
        form.append("file", file);

        const res = await fetch(`/transcode-video?codec=${codec}`, {
            method: "POST",
            body: form
        });

        const blob = await res.blob();
        download(blob, `output_${codec}`);
    }

    async function ladder() {
        const file = document.getElementById("fileInput").files[0];
        if (!file) { alert("Please upload a video."); return; }

        const form = new FormData();
        form.append("file", file);

        const res = await fetch("/encoding-ladder", {
            method: "POST",
            body: form
        });

        const blob = await res.blob();
        download(blob, "encoding_ladder.zip");
    }

    async function videoInfo() {
        const file = document.getElementById("fileInput").files[0];
        if (!file) { alert("Please upload a video."); return; }

        const form = new FormData();
        form.append("file", file);

        const res = await fetch("/process-video-info", {
            method: "POST",
            body: form
        });

        document.getElementById("infoDisplay").textContent =
            JSON.stringify(await res.json(), null, 4);
    }

    function download(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        a.click();
    }
</script>

</body>
</html>
